(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5484bf7a"],{"809b":function(t,i,a){"use strict";a.r(i);a("99af"),a("d81d"),a("ac1f"),a("841c");var n=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-maps"},[i("div",{staticClass:"m-maps-pic"},[t.mapId?i("img",{attrs:{src:t.currentMap}}):[i("dragWrap",{attrs:{data:t.scale}},[i("div",{staticClass:"m-map__world"},[t._l(t.maps,(function(a,n){return i("span",{key:n,staticClass:"u-map",style:"left:".concat(a.Left||0,"px;top:").concat(a.Top||0,"px"),on:{click:function(i){return t.showChild(a)}}},[t._v(" "+t._s(a.szDisplayName)+" ")])})),i("img",{staticClass:"u-img",attrs:{src:t.map,alt:t.$t("世界地图")}}),i("img",{staticClass:"u-traffic",attrs:{src:t.traffic,alt:"交通路线"}})],2)])]],2),i("div",{staticClass:"m-toolbar"},[i("h1",{staticClass:"m-maps__title"},[t._v(t._s(t.title))]),i("el-input",{attrs:{size:"small",clearable:""},model:{value:t.search,callback:function(i){t.search=i},expression:"search"}},[i("template",{slot:"prepend"},[t._v(t._s(t.$t("地图")))])],2),i("el-button-group",[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-arrow-left"},on:{click:function(i){return t.changePage("prev")}}},[t._v("上一页")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return t.changePage("next")}}},[t._v(" 下一页 "),i("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1),i("div",{staticClass:"u-world-map",on:{click:t.changeWorldMap}},[t._v(t._s(t.$t("世界地图")))]),i("div",{class:[{mapId:t.mapId},"m-mapList"]},t._l(t.mapsList,(function(a){return i("div",{key:a.ID,class:["u-item",{active:a.ID==t.mapId}],attrs:{label:a.MapName,value:a.ID},on:{click:function(i){return t.changeMap(a.ID)}}},[t._v(" "+t._s(a.DisplayName)+" ")])})),0)],1),i("el-dialog",{attrs:{"custom-class":"m-maps-dialog",title:"提示",visible:t.visible,width:"600"},on:{"update:visible":function(i){t.visible=i}}},[i("div",{staticClass:"m-city"},t._l(t.children,(function(a,n){return i("span",{key:n,on:{click:function(i){return t.showMap(a)}}},[t._v(t._s(a.szComment))])})),0),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(i){t.visible=!1}}},[t._v("关 闭")])],1)])],1)},e=[],s=a("5530"),o=(a("4de4"),a("caad"),a("d3b7"),a("2532"),a("c7eb")),c=a("1da1"),r=a("41cb"),l=Object(r["c"])(),u=function(){var t=Object(c["a"])(Object(o["a"])().mark((function t(i){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",l.get("/map/worldmap",{params:i}));case 1:case"end":return t.stop()}}),t)})));return function(i){return t.apply(this,arguments)}}(),p=function(){var t=Object(c["a"])(Object(o["a"])().mark((function t(i){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",l.get("/map",{params:i}));case 1:case"end":return t.stop()}}),t)})));return function(i){return t.apply(this,arguments)}}(),h=a("65c2"),m=function(){var t=this,i=t._self._c;return i("div",{ref:"container",staticClass:"p-map",on:{mousedown:t.startDrag,mousemove:t.drag,mouseup:t.stopDrag,mouseleave:t.stopDrag}},[i("div",{ref:"map",staticClass:"m-list",style:{transform:"translate(".concat(t.position.x,"px, ").concat(t.position.y,"px) scale(").concat(t.scale,")")},on:{click:t.preventClick}},[t._t("default")],2)])},d=[],f=a("2909"),v=(a("159b"),{name:"dragWrap",props:{data:{type:Object,default:function(){return{}}}},data:function(){return{scale:1,isDragging:!1,startPosition:{x:0,y:0},offset:{x:0,y:0},position:{x:0,y:0},velocity:{x:0,y:0},lastPosition:{x:0,y:0},lastTime:0,dampingFactor:.9,momentumMultiplier:0,containerBounds:null}},watch:{data:{handler:function(t){var i=t.x,a=t.y,n=t.scale;i&&(this.position.x=i,this.position.y=a,this.scale=n)},deep:!0,immediate:!0}},mounted:function(){var t=this;this.$nextTick((function(){var i=t.$refs.map;i.addEventListener("wheel",t.handleScroll),t.containerBounds=t.$refs.container.getBoundingClientRect(),window.addEventListener("resize",t.updateContainerBounds);var a=document.getElementsByTagName("img");Object(f["a"])(a).forEach((function(t){t.addEventListener("dragstart",(function(t){t.preventDefault()}))}))}))},methods:{startDrag:function(t){this.isDragging=!0,this.startPosition.x=t.clientX,this.startPosition.y=t.clientY,this.offset.x=t.clientX-this.position.x,this.offset.y=t.clientY-this.position.y,this.velocity.x=0,this.velocity.y=0,this.lastTime=Date.now(),this.lastPosition.x=t.clientX,this.lastPosition.y=t.clientY},drag:function(t){if(this.isDragging){var i=Date.now(),a=i-this.lastTime;this.velocity.x=(t.clientX-this.lastPosition.x)/a,this.velocity.y=(t.clientY-this.lastPosition.y)/a,this.position.x=t.clientX-this.offset.x,this.position.y=t.clientY-this.offset.y,this.lastTime=i,this.lastPosition.x=t.clientX,this.lastPosition.y=t.clientY,this.updateMomentumMultiplier(t.clientX,t.clientY)}},stopDrag:function(){this.isDragging=!1,this.applyMomentum()},updateMomentumMultiplier:function(t,i){var a=Math.sqrt(Math.pow(t-this.startPosition.x,2)+Math.pow(i-this.startPosition.y,2));this.momentumMultiplier=.01*a},applyMomentum:function(){var t=this,i=function i(){t.position.x+=t.velocity.x*t.momentumMultiplier,t.position.y+=t.velocity.y*t.momentumMultiplier,(Math.abs(t.velocity.x)>.1||Math.abs(t.velocity.y)>.1)&&(t.velocity.x*=t.dampingFactor,t.velocity.y*=t.dampingFactor,requestAnimationFrame(i))};requestAnimationFrame(i)},updateContainerBounds:function(){this.containerBounds=this.$refs.container.getBoundingClientRect()},preventClick:function(t){this.isDragging&&t.stopPropagation()},handleScroll:function(t){var i=t.deltaY||t.detail||t.wheelDelta,a=.05;i<0?(this.scale+=a,this.scale>1.8&&(this.scale=1.8)):(this.scale-=a,this.scale<.2&&(this.scale=.2)),t.preventDefault()}},beforeDestroy:function(){window.removeEventListener("wheel",this.handleScroll),window.removeEventListener("resize",this.updateContainerBounds)}}),g=v,y=a("2877"),b=Object(y["a"])(g,m,d,!1,null,null,null),w=b.exports,x=a("2ef0"),_={name:"Map",components:{dragWrap:w},data:function(){return{loading:!1,mapId:0,city:[],fb:[],maps:[],mapsList:[],search:"",page:1,per:17,count:0,title:"世界地图",children:[],visible:!1,scale:{x:-122,y:-1400,scale:.35}}},computed:{currentMap:function(){return"".concat(h["__imgPath"],"map/maps/map_").concat(this.mapId,"_0.png")},map:function(){return"".concat(h["__imgPath"],"topic/pic/map.jpg")},traffic:function(){return"".concat(h["__imgPath"],"topic/pic/traffic.png")},client:function(){return this.$store.state.client},params:function(){var t={per:this.per,page:this.page,client:this.client};return this.search&&(t.search=this.search),t}},watch:{params:{deep:!0,handler:function(){this.load()}},mapId:function(t){null!==t&&""!==t&&void 0!==t||(this.mapId=0);var i=this.maps.filter((function(i){return i.ID==t}))[0],a=this.mapsList.filter((function(i){return i.ID==t}))[0];this.title=(null===i||void 0===i?void 0:i.szDisplayName)||(null===a||void 0===a?void 0:a.DisplayName)||this.title}},mounted:function(){this.load()},methods:{changeMap:function(t){this.mapId=t||0},showMap:function(t){var i=t.dwMapID,a=t.szComment;this.changeMap(i),this.title=a,this.visible=!1},changeWorldMap:function(){this.mapId=0,this.title="世界地图",this.scale=Object(s["a"])(Object(s["a"])({},this.$options.data().scale),{},{map:Math.random()})},changePage:function(t){var i=this.page;"prev"===t?i--:i<this.count/this.per&&i++,this.page=i<0?0:i},load:function(){var t=this;this.loading=!0,u().then((function(i){var a=i.data.data||[],n=a.zoning,e=a.city,s=a.copy;t.city=e||[],t.fb=s||[],t.maps=n.filter((function(t){return t.szDisplayName}))})).finally((function(){t.loading=!0})),p(this.params).then((function(i){t.mapsList=i.data.data.list||[],t.count=i.data.data.count}))},showChild:function(t){var i=t.szChildCityMaps,a=t.szChildCopyMaps,n=[],e=[];i&&i.length&&(n=this.city.filter((function(t){return i.includes(t.dwMapID)}))),a&&a.length&&(e=this.fb.filter((function(t){return a.includes(t.dwMapID)})));var s=n.concat(e).filter((function(t){return t.szComment}))||[];s.length&&(this.children=Object(x["uniqBy"])(s,"dwMapID"),this.visible=!0)},mapLink:function(){}}},M=_,D=(a("9e10"),Object(y["a"])(M,n,e,!1,null,null,null));i["default"]=D.exports},"9d1c":function(t,i,a){},"9e10":function(t,i,a){"use strict";a("9d1c")}}]);
//# sourceMappingURL=chunk-5484bf7a.5747cc4a.js.map