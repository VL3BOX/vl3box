"use strict";(self["webpackChunkpvp"]=self["webpackChunkpvp"]||[]).push([[739],{60796:function(e,t,n){n.d(t,{A:function(){return Ct}});var o=n(20641),a=n(90033);const s={class:"c-comment-order"},i={class:"u-label"},r={class:"c-comment-pages"},l={class:"u-pages"};function m(e,t,n,m,c,u){const d=(0,o.g2)("CommentInputForm"),p=(0,o.g2)("el-radio-button"),h=(0,o.g2)("el-radio-group"),g=(0,o.g2)("CommentAvatar"),y=(0,o.g2)("CommentWithReply"),f=(0,o.g2)("el-pagination"),k=(0,o.g2)("el-main"),b=(0,o.g2)("el-container"),C=(0,o.gN)("loading");return(0,o.bo)(((0,o.uX)(),(0,o.Wv)(b,{class:"c-comment"},{default:(0,o.k6)((()=>[(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(d,{onSubmit:u.userSubmitInputForm},null,8,["onSubmit"]),(0,o.Lk)("div",s,[(0,o.Lk)("span",i,(0,a.v_)(e.$t("排序模式：")),1),(0,o.bF)(h,{modelValue:e.isDesc,"onUpdate:modelValue":t[0]||(t[0]=t=>e.isDesc=t),onChange:u.changeOrder,size:"small"},{default:(0,o.k6)((()=>[(0,o.bF)(p,{label:"DESC"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("最后靠前")),1)])),_:1}),(0,o.bF)(p,{label:"ASC"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("最早靠前")),1)])),_:1})])),_:1},8,["modelValue","onChange"])]),u.isNormal?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.commentList,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"c-comment-list"},[(0,o.bF)(g,{"user-avatar":u.showAvatar(t.avatar),"user-href":u.profileLink(t.userId),username:t.displayName,avatarFrame:t.user_avatar_frame,withFrame:!0,avatarSize:48},null,8,["user-avatar","user-href","username","avatarFrame"]),(0,o.bF)(y,{"base-api":e.baseAPI,item:t,category:n.category,power:e.commentPower,onDeleteComment:u.deleteComment,onSetTopComment:u.setTopComment,onSetStarComment:u.setStarComment,"user-href":u.profileLink(t.userId),username:t.displayName},null,8,["base-api","item","category","power","onDeleteComment","onSetTopComment","onSetStarComment","user-href","username"])])))),128)),(0,o.Lk)("div",r,[e.commentList.length>5?((0,o.uX)(),(0,o.Wv)(d,{key:0,onSubmit:u.userSubmitInputForm,isBottom:e.commentList.length>5},null,8,["onSubmit","isBottom"])):(0,o.Q3)("",!0),(0,o.Lk)("div",l,[(0,o.bF)(f,{style:{"text-align":"right"},background:"","hide-on-single-page":"",onCurrentChange:u.handleCurrentChange,"current-page":e.pager.index,"page-size":e.pager.pageSize,layout:"prev, pager, next, total",total:e.pager.total},null,8,["onCurrentChange","current-page","page-size","total"])])])],64)):(0,o.Q3)("",!0)])),_:1})])),_:1})),[[C,e.loading]])}var c=n(26693);const u={class:"c-comment-avatar"},d=["href"],p=["src"];function h(e,t,n,s,i,r){const l=(0,o.g2)("el-avatar"),m=(0,o.g2)("el-link");return(0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("a",{class:"u-avatar",href:n.userHref,target:"_blank"},[(0,o.bF)(l,{class:(0,a.C4)(["u-avatar-pic",36==n.avatarSize?"xxs":""]),shape:"circle",size:n.avatarSize,src:n.userAvatar},null,8,["class","size","src"]),n.avatarFrame?((0,o.uX)(),(0,o.CE)("i",{key:0,class:(0,a.C4)(["u-avatar-frame",36==n.avatarSize?"xxs":"xs"])},[(0,o.Lk)("img",{src:r.frameUrl},null,8,p)],2)):(0,o.Q3)("",!0)],8,d),(0,o.bF)(m,{class:"u-name",type:"primary",target:"_blank",href:n.userHref},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(n.username),1)])),_:1},8,["href"])])}var g=n(38364);const{__imgPath:y}=g;var f={name:"CommentAvatar",props:["avatarSize","userAvatar","userHref","username","avatarFrame","withFrame"],data:function(){return{}},computed:{frameUrl:function(){return y+`avatar/images/${this.avatarFrame}/${this.avatarFrame}.svg`}},methods:{},mounted:function(){}},k=n(66262);const b=(0,k.A)(f,[["render",h]]);var C=b;const v={class:"c-comment-tools"},w={class:"u-toolbar"};function _(e,t,n,s,i,r){const l=(0,o.g2)("el-input"),m=(0,o.g2)("Picture"),c=(0,o.g2)("el-icon"),u=(0,o.g2)("Emotion"),d=(0,o.g2)("Uploader"),p=(0,o.g2)("el-button"),h=(0,o.g2)("el-form-item"),g=(0,o.g2)("el-form");return(0,o.uX)(),(0,o.Wv)(g,{ref:"form",model:e.newComment,class:"c-comment-box"},{default:(0,o.k6)((()=>[(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,{rows:"3",type:"textarea",maxlength:"300","show-word-limit":"",modelValue:e.newComment.content,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newComment.content=t),placeholder:e.$t("参与讨论..."),id:e.inputId},null,8,["modelValue","placeholder","id"]),(0,o.Lk)("div",v,[(0,o.bF)(c,{class:"u-upload-icon",onClick:t[1]||(t[1]=t=>e.showUploader=!e.showUploader)},{default:(0,o.k6)((()=>[(0,o.bF)(m)])),_:1}),(0,o.bF)(u,{class:"c-comment-emotion",onSelected:r.handleEmotionSelected,type:"pop",max:6},null,8,["onSelected"])]),e.showUploader?((0,o.uX)(),(0,o.Wv)(d,{key:0,class:"u-uploader",ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUploadError},null,8,["onOnFinish","onOnError"])):(0,o.Q3)("",!0),(0,o.Lk)("div",w,[(0,o.bF)(p,{type:"primary",onClick:r.onSubmit,class:"u-publish",disabled:e.disableSubmitBtn},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("发表评论")),1)])),_:1},8,["onClick","disabled"])])])),_:1})])),_:1},8,["model"])}const F={class:"el-upload__tip"},$=["src"];function S(e,t,n,s,i,r){const l=(0,o.g2)("Plus"),m=(0,o.g2)("el-icon"),c=(0,o.g2)("el-upload"),u=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(c,{action:"https://cms.jx3box.com/api/cms/upload",ref:"upload","list-type":"picture-card","on-preview":r.handlePictureCardPreview,"auto-upload":!1,"file-list":i.fileList,limit:i.maxCount,accept:i.acceptedExtensions.reduce(((e,t)=>e+`.${t},`),""),multiple:"","with-credentials":"","on-exceed":r.onExceed,"on-change":r.onChange,"on-success":r.onSuccess,"on-error":r.onError},{tip:(0,o.k6)((()=>[(0,o.Lk)("div",F,(0,a.v_)(e.$t("最多上传")+` ${i.maxCount} `+e.$t("张"))+" "+(0,a.v_)(i.acceptedExtensions.join(" / ").toUpperCase()+e.$t("格式图片，单张图片不能超过"))+" "+(0,a.v_)(i.maxSize/1024/1024)+"MB ",1)])),default:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(l)])),_:1})])),_:1},8,["on-preview","file-list","limit","accept","on-exceed","on-change","on-success","on-error"]),(0,o.bF)(u,{modelValue:i.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>i.dialogVisible=e)},{default:(0,o.k6)((()=>[(0,o.Lk)("img",{width:"60%",src:i.dialogImageUrl,alt:""},null,8,$)])),_:1},8,["modelValue"])])}var L={name:"CommentUploader",data(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:2097152}},emits:["onFinish","onError"],methods:{handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},onExceed(){this.$notify({title:"",message:`最多上传 ${this.maxCount} 张图片！`,type:"error",duration:3e3,position:"bottom-right"})},onChange(e,t){"ready"==e.status&&(e.size>this.maxSize?(this.$notify({title:"",message:`单张图片大小不能超过 ${this.maxSize/1024/1024} MB！`,type:"error",duration:3e3,position:"bottom-right"}),t.pop()):this.fileList=t)},upload(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess(e){this.successList=this.successList.concat(e.data),this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[])},onError(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}};const x=(0,k.A)(L,[["render",S]]);var R=x,I=n.p+"img/emotion.08adf9c0.svg";const E={class:"c-jx3box-emotion"},U=["onClick"],A=["src","alt","title"],W={class:"c-jx3box-emotion-pop__content"},P={class:"u-title"},T=["src","alt","title"],X={class:"c-jx3box-emotion-list"},D=["onClick"],z=["src","alt","title"],j=(0,o.Lk)("img",{slot:"reference",class:"u-reference",width:"24",height:"24",src:I,alt:""},null,-1);function N(e,t,n,s,i,r){const l=(0,o.g2)("el-tab-pane"),m=(0,o.g2)("el-tabs"),c=(0,o.g2)("Close"),u=(0,o.g2)("el-icon"),d=(0,o.g2)("el-popover");return(0,o.uX)(),(0,o.CE)("div",E,["default"===n.type?((0,o.uX)(),(0,o.Wv)(m,{key:0,type:"card"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.decorationEmotion,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.group_id,label:e.group_name},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.items,(e=>((0,o.uX)(),(0,o.CE)("span",{key:e.emotion_id,class:"c-jx3box-emotion-item",onClick:t=>r.handleEmotionClick(e)},[(0,o.Lk)("img",{src:`${i.EmojiPath}${e.filename}`,alt:e.key,title:e.key},null,8,A)],8,U)))),128))])),_:2},1032,["label"])))),128))])),_:1})):((0,o.uX)(),(0,o.Wv)(d,{key:1,placement:"top",trigger:"click","visible-arrow":!1,"popper-class":"c-jx3box-emotion-pop",ref:"emotion"},{reference:(0,o.k6)((()=>[j])),default:(0,o.k6)((()=>[(0,o.Lk)("div",W,[(0,o.bF)(u,{class:"u-close",onClick:r.closePop},{default:(0,o.k6)((()=>[(0,o.bF)(c)])),_:1},8,["onClick"]),(0,o.Lk)("div",P,(0,a.v_)(e.$t("表情")),1),(0,o.bF)(m,{class:"u-tabs",type:"card","tab-position":"bottom",size:"small"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.decorationEmotion,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.group_id,label:e.group_name},{label:(0,o.k6)((()=>[(0,o.Lk)("img",{src:`${i.EmojiPath}${e.items[0].filename}`,alt:e.items[0].key,title:e.group_name,class:"u-tab-label"},null,8,T)])),default:(0,o.k6)((()=>[(0,o.Lk)("div",X,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.items,(e=>((0,o.uX)(),(0,o.CE)("span",{key:e.emotion_id,class:"c-jx3box-emotion-item",onClick:t=>r.handleEmotionClick(e)},[(0,o.Lk)("img",{src:`${i.EmojiPath}${e.filename}`,alt:e.key,title:e.key},null,8,z)],8,D)))),128))])])),_:2},1032,["label"])))),128))])),_:1})])])),_:1},512))])}var B=n(91250);const{__cms:O}=g,Q=e=>{const t=e&&e.domain||O;let n={withCredentials:!0,auth:{username:localStorage&&localStorage.getItem("token")||"",password:"cms common request"},baseURL:t,headers:{}};const o=B.A.create(n);return o};var V=n(40192);const{__imgPath:H,__dataPath:M}=g;var J={name:"Emotion",props:{type:{type:String,default:"default"},max:{type:Number,default:4}},emits:["selected"],data(){return{emotionList:[],EmojiPath:H+"emotion/output/",decoration:[]}},created(){this.loadEmotionList(),this.loadDecoration()},computed:{decorationEmotion({emotionList:e,decoration:t}){const n=e.filter((e=>0===e.group_id));if(0===t.length)return n;{const o=e.filter((e=>t.includes(e.group_name)));return[...n,...o].slice(0,this.max)}}},methods:{handleEmotionClick(e){this.$emit("selected",e),this.closePop()},loadEmotionList(){try{const e=sessionStorage.getItem("jx3_emotion");if(e)return void(this.emotionList=JSON.parse(e));fetch(`${M}emotion/output/catalog.json`).then((e=>e.json())).then((e=>{this.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}catch(e){fetch(`${M}emotion/output/catalog.json`).then((e=>e.json())).then((e=>{this.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}},loadDecoration(){V.A.isLogin()&&Q().get("/api/cms/user/decoration",{params:{type:"emotion",using:1}}).then((e=>{this.decoration=e.data?.data?.map((e=>e?.val))}))},closePop(){this.$refs.emotion&&this.$refs.emotion.hide()}}};const K=(0,k.A)(J,[["render",N]]);var G=K,q={components:{Uploader:R,Emotion:G},props:{isBottom:{type:Boolean,default:!1}},mounted(){this.isBottom&&(this.inputId="textarea-bottom")},data:function(){return{showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top"}},methods:{onSubmit(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},attachmentUploadFinish(e){this.$emit("submit",{content:this.newComment.content,attachmentList:e}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUploadError(){this.disableSubmitBtn=!1},handleEmotionSelected(e){this.insertVariable(e)},async insertVariable(e){const t=document.querySelector(`#${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.newComment.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.newComment.content=n}}};const Y=(0,k.A)(q,[["render",_]]);var Z=Y;const ee={class:"c-comment-cmt"},te={key:0,class:"u-mark u-top"},ne=(0,o.Lk)("i",{class:"Download"},null,-1),oe={key:1,class:"u-mark u-star"},ae=(0,o.Lk)("i",{class:"Star"},null,-1);function se(e,t,n,s,i,r){const l=(0,o.g2)("el-link"),m=(0,o.g2)("CommentContent"),c=(0,o.g2)("ReplyList");return(0,o.uX)(),(0,o.CE)("div",ee,[(0,o.Lk)("div",null,[(0,o.bF)(l,{class:"u-name",type:"primary",target:"_blank",href:e.userHref},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(n.username||e.$t("人字榜800线无名小侠")),1)])),_:1},8,["href"]),n.item.is_top?((0,o.uX)(),(0,o.CE)("span",te,[ne,(0,o.eW)((0,a.v_)(e.$t("置顶")),1)])):(0,o.Q3)("",!0),n.item.is_star?((0,o.uX)(),(0,o.CE)("span",oe,[ae,(0,o.eW)((0,a.v_)(e.$t("精华")),1)])):(0,o.Q3)("",!0)]),(0,o.bF)(m,{date:n.item.commentDate,content:n.item.content,"comment-id":n.item.id,attachments:r.stringToArray(n.item.attachments),"can-delete":n.power.allow||n.power.uid==n.item.userId,"can-set-top":n.power.is_author&&!n.item.is_top,"can-cancel-top":n.power.is_author&&n.item.is_top,"can-set-star":!n.item.is_star&&n.power.group>=64,"can-cancel-star":n.item.is_star&&n.power.group>=64,onAddNewReply:r.addNewReply,onDeleteComment:r.deleteComment,onSetTopComment:r.setTopComment,onSetStarComment:r.setStarComment},null,8,["date","content","comment-id","attachments","can-delete","can-set-top","can-cancel-top","can-set-star","can-cancel-star","onAddNewReply","onDeleteComment","onSetTopComment","onSetStarComment"]),(0,o.bF)(c,{data:e.replyList,pager:e.pager,power:n.power,onAddNewReply:r.addNewReply,onDeleteReply:r.deleteReply,onGoto:r.gotoReplyListIndex,onResetReply:r.resetReply},null,8,["data","pager","power","onAddNewReply","onDeleteReply","onGoto","onResetReply"])])}const ie={class:"u-cmt"},re=["innerHTML"],le={key:1,class:"u-attachements"},me={class:"u-toolbar"},ce={class:"u-date"},ue=(0,o.Lk)("i",{class:"Clock"},null,-1),de={class:"c-comment-tools"};function pe(e,t,n,s,i,r){const l=(0,o.g2)("el-image"),m=(0,o.g2)("el-button"),c=(0,o.g2)("el-input"),u=(0,o.g2)("el-form-item"),d=(0,o.g2)("Picture"),p=(0,o.g2)("el-icon"),h=(0,o.g2)("Emotion"),g=(0,o.g2)("Uploader"),y=(0,o.g2)("el-form");return(0,o.uX)(),(0,o.CE)("div",ie,[""!=n.content?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"u-text",innerHTML:r.formatContent(n.content)},null,8,re)):(0,o.Q3)("",!0),n.attachments.length?((0,o.uX)(),(0,o.CE)("div",le,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.attachments,(e=>((0,o.uX)(),(0,o.Wv)(l,{key:e,src:r.showAttachment(e),"preview-src-list":[r.showPreview(e)],lazy:""},null,8,["src","preview-src-list"])))),128))])):(0,o.Q3)("",!0),(0,o.Lk)("div",me,[(0,o.bF)(m,{class:"u-admin",link:"",size:"small",icon:"ChatRound",onClick:t[0]||(t[0]=t=>e.showForm=!e.showForm),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("回复")),1)])),_:1}),n.canDelete?((0,o.uX)(),(0,o.Wv)(m,{key:0,class:"u-admin",link:"",icon:"Delete",size:"small",onClick:t[1]||(t[1]=e=>r.deleteComment()),type:"danger"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("删除")),1)])),_:1})):(0,o.Q3)("",!0),n.canSetTop?((0,o.uX)(),(0,o.Wv)(m,{key:1,class:"u-admin",link:"",icon:"Top",size:"small",onClick:t[2]||(t[2]=e=>r.topComment(!0)),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("置顶")),1)])),_:1})):(0,o.Q3)("",!0),n.canCancelTop?((0,o.uX)(),(0,o.Wv)(m,{key:2,class:"u-admin",link:"",icon:"Top",size:"small",onClick:t[3]||(t[3]=e=>r.topComment(!1)),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("取消置顶")),1)])),_:1})):(0,o.Q3)("",!0),n.canSetStar?((0,o.uX)(),(0,o.Wv)(m,{key:3,class:"u-admin",link:"",icon:"Star",size:"small",onClick:t[4]||(t[4]=e=>r.starComment(!0)),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("加精")),1)])),_:1})):(0,o.Q3)("",!0),n.canCancelStar?((0,o.uX)(),(0,o.Wv)(m,{key:4,class:"u-admin",link:"",icon:"StarFilled",size:"small",onClick:t[5]||(t[5]=e=>r.starComment(!1)),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("取消加精")),1)])),_:1})):(0,o.Q3)("",!0),(0,o.Lk)("time",ce,[ue,(0,o.eW)(" "+(0,a.v_)(r.dataFormat(n.date)),1)])]),e.showForm?((0,o.uX)(),(0,o.Wv)(y,{key:2,ref:"form",model:e.newComment,class:"c-comment-subbox"},{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{type:"textarea",modelValue:e.newComment.content,"onUpdate:modelValue":t[6]||(t[6]=t=>e.newComment.content=t),placeholder:e.$("参与评论..."),id:"id"+e.inputId},null,8,["modelValue","placeholder","id"])])),_:1}),(0,o.bF)(u,{class:"c-comment-tool-box"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",de,[(0,o.bF)(p,{class:"u-upload-icon",onClick:t[7]||(t[7]=t=>e.showUploader=!e.showUploader)},{default:(0,o.k6)((()=>[(0,o.bF)(d)])),_:1}),(0,o.bF)(h,{class:"c-comment-emotion",onSelected:r.handleEmotionSelected,type:"pop",max:6},null,8,["onSelected"])]),e.showUploader?((0,o.uX)(),(0,o.Wv)(g,{key:0,ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUplodError},null,8,["onOnFinish","onOnError"])):(0,o.Q3)("",!0)])),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{size:"small",type:"primary",onClick:t[8]||(t[8]=e=>r.submit()),disabled:e.disableSubmitBtn},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("提交")),1)])),_:1},8,["disabled"]),(0,o.bF)(m,{size:"small",link:"",onClick:t[9]||(t[9]=t=>e.showForm=!1),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("收起")),1)])),_:1})])),_:1})])),_:1},8,["model"])):(0,o.Q3)("",!0)])}var he=n(74692),ge=n.n(he),ye=n(2543);const{__imgPath:fe,__dataPath:ke}=g;async function be(){const e=sessionStorage.getItem("jx3_emotion");if(e)return JSON.parse(e);{const e=await fetch(`${ke}emotion/output/catalog.json`).then((e=>e.json()));return sessionStorage.setItem("jx3_emotion",JSON.stringify(e)),e}}class Ce{constructor(e){this._joke=ge().trim(e),this.emotionList=[],this.max=0}async loadEmotionList(){const e=await be();this.emotionList=e}async _renderHTML(){let e=this._joke;if(!e.includes("#"))return e;for(let t=0;t<3;t++){await this.loadEmotionList();const t=(0,ye.flatMapDeep)(this.emotionList.map((e=>e.items))),n=t.map((e=>e.key));while(n.some((t=>e.includes(t)))){const t=n.findIndex((t=>e.includes(t))),o=n[t].replace("#","$");e=t>-1?e.replace(n[t],o):e}while(n.some((t=>e.includes(`${t.replace("#","$")}`)))){const o=n.findIndex((t=>e.includes(t.replace("#","$")))),a=t.find((e=>e.key===n[o])),s=a?`${fe}emotion/output/${a.filename}`:"",i=n[o].replace("#","$");e=s?e.replace(i,`<img src="${s}" alt="${n[o]}" title="${n[o]}" />`):e}if(this.emotionList.length)break}return e}}var ve=Ce;function we(e){const t=new ve(e);return t.code}function _e(e){return e>9?e:`0${e}`}var Fe={props:["content","date","hasReply","canDelete","canSetTop","canCancelTop","canSetStar","canCancelStar","attachments","commentId"],components:{Uploader:R,Emotion:G},data:function(){return{newComment:{content:""},showForm:!1,disableSubmitBtn:!1,showUploader:!1,inputId:"",previewList:[]}},mounted(){this.commentId&&(this.inputId=this.commentId)},computed:{_attachments:function(){return this.attachments.map((e=>(0,c.resolveImagePath)(e)))}},methods:{topComment(e){this.$emit("setTopComment",e)},starComment(e){this.$emit("setStarComment",e)},deleteComment(){this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("deleteComment")})).catch((()=>{}))},dataFormat(e){let t=new Date(e);return t.getFullYear()+"-"+_e(t.getMonth()+1)+"-"+_e(t.getDate())+" "+_e(t.getHours())+":"+_e(t.getMinutes())+":"+_e(t.getSeconds())},attachmentUploadFinish(e){this.disableSubmitBtn=!1,this.$emit("addNewReply",{content:this.newComment.content,attachmentList:e}),this.showUploader=!1,this.newComment={content:""}},attachmentUplodError(){this.disableSubmitBtn=!1},submit(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm(){},formatContent:we,async handleEmotionSelected(e){const t=document.querySelector(`#id${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.newComment.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.newComment.content=n},showPreview:function(e){return(0,c.resolveImagePath)(e)},showAttachment:function(e){return(0,c.resolveImagePath)(e)+"?x-oss-process=style/comment_thumb"}}};const $e=(0,k.A)(Fe,[["render",pe]]);var Se=$e,Le=n(53751);const xe={key:0,class:"c-comment-replylist"};function Re(e,t,n,s,i,r){const l=(0,o.g2)("reply-item"),m=(0,o.g2)("el-button"),c=(0,o.g2)("el-col"),u=(0,o.g2)("el-pagination"),d=(0,o.g2)("el-row");return n.data.length?((0,o.uX)(),(0,o.CE)("div",xe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.data,(e=>((0,o.uX)(),(0,o.Wv)(l,{class:"c-comment-reply",key:e.id,reply:e,power:n.power,onDeleteReply:r.deleteReply,onAddReply:r.addReply},null,8,["reply","power","onDeleteReply","onAddReply"])))),128)),n.data.length>=3||e.showPager?((0,o.uX)(),(0,o.Wv)(d,{key:0},{default:(0,o.k6)((()=>[(0,o.bF)(c,{span:4},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(m,{link:"",onClick:t[0]||(t[0]=e=>r.showLess())},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("收起")),1)])),_:1},512),[[Le.aG,e.showPager]]),(0,o.bo)((0,o.bF)(m,{link:"",onClick:t[1]||(t[1]=e=>r.showMore())},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("查看更多")),1)])),_:1},512),[[Le.aG,!e.showPager]])])),_:1}),(0,o.bF)(c,{span:20,class:"c-comment-reply-pages"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(u,{small:"",onCurrentChange:r.handleCurrentChange,"current-page":n.pager.index,"page-size":n.pager.pageSize,layout:"total, prev, pager, next",total:n.pager.total},null,8,["onCurrentChange","current-page","page-size","total"]),[[Le.aG,e.showPager]])])),_:1})])),_:1})):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)}function Ie(e,t,n,a,s,i){const r=(0,o.g2)("CommentAvatar"),l=(0,o.g2)("CommentContentSimple"),m=(0,o.g2)("ReplyForReply"),c=(0,o.g2)("el-row");return(0,o.uX)(),(0,o.Wv)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(r,{"user-avatar":i.showAvatar(n.reply.avatar),"user-href":i.profileLink(n.reply.userId),username:n.reply.displayName,avatarFrame:n.reply.user_avatar_frame,avatarSize:36},null,8,["user-avatar","user-href","username","avatarFrame"]),(0,o.bF)(l,{"comment-id":n.reply.id,date:n.reply.commentDate,content:n.reply.content,attachments:i.stringToArray(n.reply.attachments),"can-delete":n.power.allow||n.power.uid==n.reply.userId,"can-reply":n.power.uid!=n.reply.userId,"user-href":i.profileLink(n.reply.replyForUID),"reply-for-username":n.reply.replyForUsername,"reply-for-user-id":n.reply.replyForUID,onDelete:i.deleteReply,onShowReplyInput:t[0]||(t[0]=t=>e.showReplyForReplyFrom=!e.showReplyForReplyFrom)},null,8,["comment-id","date","content","attachments","can-delete","can-reply","user-href","reply-for-username","reply-for-user-id","onDelete"]),e.showReplyForReplyFrom?((0,o.uX)(),(0,o.Wv)(m,{key:0,username:n.reply.displayName,"user-href":i.profileLink(n.reply.userId),"current-id":n.reply.id,onHideForm:t[1]||(t[1]=t=>e.showReplyForReplyFrom=!1),onDoReply:i.doReply},null,8,["username","user-href","current-id","onDoReply"])):(0,o.Q3)("",!0)])),_:1})}const Ee={class:"u-reply"},Ue={class:"u-reply-content"},Ae={key:0,class:"u-reply-label"},We=["innerHTML"],Pe={key:0,class:"u-attachements"},Te={class:"u-toolbar"},Xe={class:"u-date"},De=(0,o.Lk)("i",{class:"Clock"},null,-1);function ze(e,t,n,s,i,r){const l=(0,o.g2)("el-link"),m=(0,o.g2)("el-image"),c=(0,o.g2)("el-button");return(0,o.uX)(),(0,o.CE)("div",Ee,[(0,o.Lk)("div",Ue,[0!=n.replyForUserId?((0,o.uX)(),(0,o.CE)("span",Ae,[(0,o.eW)((0,a.v_)(e.$t("回复"))+" ",1),(0,o.bF)(l,{type:"primary",target:"_blank",href:n.userHref},{default:(0,o.k6)((()=>[(0,o.eW)("@"+(0,a.v_)(n.replyForUsername),1)])),_:1},8,["href"]),(0,o.eW)(" : ")])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"u-reply-text",innerHTML:r.formatContent(n.content)},null,8,We)]),n.attachments.length?((0,o.uX)(),(0,o.CE)("div",Pe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.attachments,(e=>((0,o.uX)(),(0,o.Wv)(m,{key:e,src:r.showAttachment(e),"preview-src-list":[r.showPreview(e)],lazy:""},null,8,["src","preview-src-list"])))),128))])):(0,o.Q3)("",!0),(0,o.Lk)("div",Te,[n.canReply?((0,o.uX)(),(0,o.Wv)(c,{key:0,class:"u-admin",link:"",icon:"ChatLineRound",size:"small",onClick:t[0]||(t[0]=e=>r.showReplyForReplyInput()),type:"primary"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("回复")),1)])),_:1})):(0,o.Q3)("",!0),n.canDelete?((0,o.uX)(),(0,o.Wv)(c,{key:1,class:"u-admin",link:"",icon:"Delete",size:"small",type:"danger",onClick:t[1]||(t[1]=e=>r.deleteComment())},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("删除")),1)])),_:1})):(0,o.Q3)("",!0),(0,o.Lk)("time",Xe,[De,(0,o.eW)(" "+(0,a.v_)(r.dataFormat(n.date)),1)])])])}function je(e){return e>9?e:`0${e}`}var Ne={props:["commentId","content","attachments","date","hasReply","canDelete","canReply","userHref","replyForUsername","replyForUserId"],data:function(){return{showInput:!1}},computed:{_attachments:function(){return this.attachments.map((e=>(0,c.resolveImagePath)(e)))}},methods:{profileLink:function(e){return(0,c.authorLink)(e)},showAttachment:function(e){return(0,c.resolveImagePath)(e)+"?x-oss-process=style/comment_thumb"},formatContent:we,getPList(e){return e.split("\n")},deleteComment(){this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("delete",this.commentId)})).catch((()=>{}))},dataFormat(e){let t=new Date(e);return t.getFullYear()+"-"+je(t.getMonth()+1)+"-"+je(t.getDate())+" "+je(t.getHours())+":"+je(t.getMinutes())+":"+je(t.getSeconds())},showReplyForReplyInput(){this.$emit("showReplyInput")},previewImg(e){this.$hevueImgPreview({multiple:!0,nowImgIndex:e,imgList:this._attachments,controlBar:!1,clickMaskCLose:!0})},showPreview:function(e){return(0,c.resolveImagePath)(e)}}};const Be=(0,k.A)(Ne,[["render",ze]]);var Oe=Be;const Qe={class:"u-subbox-label"},Ve={class:"c-comment-tools"};function He(e,t,n,s,i,r){const l=(0,o.g2)("el-link"),m=(0,o.g2)("el-input"),c=(0,o.g2)("el-form-item"),u=(0,o.g2)("Picture"),d=(0,o.g2)("el-icon"),p=(0,o.g2)("Uploader"),h=(0,o.g2)("el-button"),g=(0,o.g2)("el-form");return(0,o.uX)(),(0,o.Wv)(g,{ref:"form",class:"c-comment-subbox"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",Qe,[(0,o.eW)((0,a.v_)(e.$t("回复"))+" ",1),(0,o.bF)(l,{type:"primary",target:"_blank",href:n.userHref},{default:(0,o.k6)((()=>[(0,o.eW)("＠"+(0,a.v_)(n.username),1)])),_:1},8,["href"]),(0,o.eW)(" ： ")]),(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":t[0]||(t[0]=t=>e.content=t),id:"id"+e.inputId,placeholder:e.$t("输入回复...")},null,8,["modelValue","id","placeholder"])])),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",Ve,[(0,o.bF)(d,{class:"u-upload-icon",onClick:t[1]||(t[1]=t=>e.showUploader=!e.showUploader)},{default:(0,o.k6)((()=>[(0,o.bF)(u)])),_:1})]),e.showUploader?((0,o.uX)(),(0,o.Wv)(p,{key:0,ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUploadError},null,8,["onOnFinish","onOnError"])):(0,o.Q3)("",!0)])),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(h,{size:"small",type:"primary",onClick:r.submitReply,disabled:e.disableSubmitBtn},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("提交")),1)])),_:1},8,["onClick","disabled"]),(0,o.bF)(h,{size:"small",link:"",onClick:t[2]||(t[2]=e=>r.hideForm())},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.$t("收起")),1)])),_:1})])),_:1})])),_:1},512)}var Me={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Uploader:R},mounted(){this.currentId&&(this.inputId=this.currentId)},methods:{submitReply(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm(){this.$emit("hideForm")},attachmentUploadFinish(e){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:e}),this.content="",this.showUploader=!1},attachmentUploadError(){this.disableSubmitBtn=!1},async handleEmotionSelected(e){const t=document.querySelector(`#id${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.content=n}}};const Je=(0,k.A)(Me,[["render",He]]);var Ke=Je,Ge={props:["reply","power"],components:{CommentAvatar:C,CommentContentSimple:Oe,ReplyForReply:Ke},backReplyList:[],data:function(){return{showReplyForReplyFrom:!1}},methods:{profileLink:function(e){return(0,c.authorLink)(e)},stringToArray:function(e){return e?JSON.parse(e):[]},showAvatar:function(e){return(0,c.showAvatar)(e,84)},deleteReply(e){this.$emit("deleteReply",e)},doReply(e){e.replyForUID=this.reply.userId,e.replyForCommentId=this.reply.id,this.$emit("addReply",e),this.showReplyForReplyFrom=!1}}};const qe=(0,k.A)(Ge,[["render",Ie]]);var Ye=qe,Ze={props:["data","power","pager"],components:{ReplyItem:Ye},data:function(){return{showPager:!1}},emits:["goto","resetReply","deleteReply","addNewReply"],methods:{showMore(){this.showPager=!0,this.$emit("goto",1)},showLess(){this.showPager=!1,this.$emit("resetReply")},handleCurrentChange(e){this.$emit("goto",e)},deleteReply(e){this.$emit("deleteReply",e)},addReply(e){this.$emit("addNewReply",e)}}};const et=(0,k.A)(Ze,[["render",Re]]);var tt=et,nt=n(61644),ot=n(66340);const at="cmt_order",{__Links:st,__next:it}=g;async function rt(){return V.A.isLogin()?(0,ot.WU)({mute:!0}).get("/api/cms/user/conf",{params:{key:at}}).then((e=>e.data.data)):new Promise((e=>{const t=localStorage.getItem(at)||"DESC";e(t)}))}async function lt(e){return V.A.isLogin()?(0,ot.WU)().put("/api/cms/user/conf",{val:e},{params:{key:at}}).then((e=>e.data.data)):new Promise((t=>{t(localStorage.setItem(at,e))}))}const mt=function(e,t){let n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return ht(e,t,n)},ct={},ut=function(e,t,n){if(ct[e])if(Date.now()-ct[e].lastest<6e4){if(ct[e].count>=6)return nt.df.warning({title:"系统",message:"你单身多久了? 动作这么快, 系统处理不过来 ( T_T )",duration:3e3,position:"bottom-right"}),new Promise(((e,t)=>{t()}));ct[e].count=ct[e].count+1}else Date.now()-ct[e].lastest>6e4&&(ct[e]={lastest:Date.now(),count:0});else ct[e]={lastest:Date.now(),count:0};let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return ht(e,t,o)},dt=function(e,t,n){let o={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return ht(e,t,o)},pt=function(e,t){let n={method:"DELETE"};return ht(e,t,n)};function ht(e,t,n){let o=it;if("/"==o[o.length-1]&&(o=o.substring(0,o.length-1)),e=o+e,n.credentials="include",t){let n=[];Object.keys(t).forEach((e=>{n.push(e+"="+t[e])}));let o=it;"/"==o[o.length-1]&&(o=o.substring(0,o.length-1)),e=e+"?"+n.join("&")}return fetch(e,n).then((e=>{switch(e.status){case 200:break;case 401:throw window.location.href=st.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 403:throw window.location.href=st.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 423:throw window.location.href=st.account.email_verify+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 406:throw e.text().then((e=>{nt.df.warning({title:"系统",message:e||"提交内容不合法,请重新提交",duration:3e3,position:"bottom-right"})})),new Error("错误:"+e.statusText);default:throw e.text().then((t=>{nt.df.error({title:"系统:"+e.statusText,message:t||"系统错误,请稍后重试!",duration:3e3,position:"bottom-right"})})),new Error("错误:"+e.statusText)}let t=e.headers.get("Content-Type");switch(t=t&&t.split(";").shift(),t){case"application/json":return e.json();default:return e.text()}}))}var gt={props:["item","baseApi","power","user-href","username"],components:{CommentContent:Se,ReplyList:tt},emits:["deleteComment","setTopComment","setStarComment","addNewReply","deleteReply","goto","resetReply"],data:function(){return{replyList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0}}},created(){this.replyList=this.item.reply||[]},methods:{stringToArray:function(e){return e?JSON.parse(e):[]},deleteComment(){this.$emit("deleteComment",this.item.id)},setTopComment(e){this.$emit("setTopComment",this.item.id,e)},setStarComment(e){this.$emit("setStarComment",this.item.id,e)},addNewReply(e){ut(`${this.baseApi}/comment/${this.item.id}/reply`,null,e).then((()=>{this.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),this.loadReplyList(this.pager.index)})).catch((()=>{}))},deleteReply(e){pt(`${this.baseApi}/comment/${e}`).then((()=>{this.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),this.loadReplyList(this.pager.index)})).catch((()=>{}))},gotoReplyListIndex(e){this.loadReplyList(e,6)},loadReplyList(e,t){mt(`${this.baseApi}/comment/${this.item.id}/reply/page/${e}?pageSize=${t}`).then((n=>{1==e&&3==t&&(this.item.reply=n.data||[]),this.replyList=n.data||[],this.pager=n.page})).catch((()=>{}))},resetReply(){this.loadReplyList(1,3)}}};const yt=(0,k.A)(gt,[["render",se]]);var ft=yt,kt={name:"CommentComp",props:["id","category","normal","order"],components:{CommentAvatar:C,CommentWithReply:ft,CommentInputForm:Z},data:function(){return{baseAPI:"",commentPower:{allow:!1,uid:-1},commentList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0},isDesc:"DESC",loading:!1}},computed:{isNormal:function(){return void 0===this.normal||this.normal}},methods:{changeOrder(){this.reloadCommentList(this.pager.index),lt(this.isDesc?"DESC":"ASC")},setTopComment(e,t){const n=t?"set":"cancel";dt(`${this.baseAPI}/comment/${e}/top/${n}`).then((()=>{this.reloadCommentList(this.pager.index)})).catch((()=>{}))},setStarComment(e,t){const n=t?"set":"cancel";dt(`${this.baseAPI}/comment/${e}/star/${n}`).then((()=>{this.reloadCommentList(this.pager.index)})).catch((()=>{}))},deleteComment(e){pt(`${this.baseAPI}/comment/${e}`).then((()=>{this.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),this.reloadCommentList(this.pager.index)})).catch((()=>{}))},reloadCommentList(e){this.loading=!0;let t={};"DESC"===this.isDesc&&(t["desc"]=!0),mt(`${this.baseAPI}/comment/page/${e}`,t).then((e=>{this.commentList=e.data||[],this.pager=e.page})).catch((()=>{})).finally((()=>{this.loading=!1}))},handleCurrentChange(e){this.reloadCommentList(e)},userSubmitInputForm(e){ut(`${this.baseAPI}/comment`,null,e).then((e=>{e&&~~e.code>0?this.$notify({title:"评论失败",message:e.msg||"",type:"error",duration:3e3,position:"bottom-right"}):(this.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),1==this.pager.index&&this.reloadCommentList(this.pager.index))})).catch((()=>{}))},profileLink:function(e){return(0,c.authorLink)(e)},showAvatar:function(e){return(0,c.showAvatar)(e,144)}},created(){this.baseAPI=`/api/next2/comment/${this.category}/article/${this.id}`},mounted(){rt().then((e=>{this.isDesc=e})).then((()=>{mt(`${this.baseAPI}/i-am-author`).then((e=>{this.commentPower=e})).catch((()=>{}))})).finally((()=>{this.reloadCommentList(1)}))}};const bt=(0,k.A)(kt,[["render",m]]);var Ct=bt}}]);
//# sourceMappingURL=739.bb1b8973.js.map