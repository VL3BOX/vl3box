(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5707c903"],{"0906":function(t,e,n){"use strict";n("3863")},"125d":function(t,e,n){"use strict";n("b5d3")},"13d5":function(t,e,n){"use strict";var i=n("23e7"),s=n("d58f").left,a=n("a640"),o=n("2d00"),r=n("605d"),c=!r&&o>79&&o<83,l=c||!a("reduce");i({target:"Array",proto:!0,forced:l},{reduce:function(t){var e=arguments.length;return s(this,t,e,e>1?arguments[1]:void 0)}})},"16f7":function(t,e,n){},"18aa":function(t,e,n){"use strict";n("16f7")},"25c3":function(t){t.exports=JSON.parse('["真不错，谢谢楼主#胜利#笨猪#胜利","辛苦了，感谢楼主的付出","谢谢楼主，很有用","剑三真好玩，魔盒真好用"]')},3863:function(t,e,n){},"43c2":function(t,e,n){},4437:function(t){t.exports=JSON.parse('{"e":{"1":"魔盒官网","2":"魔盒移动（小程序/APP）","3":"魔盒助手（客户端）","4":"剑三游戏客户端","5":"剑三游戏插件","6":"其它"},"d":{"1":"Bug异常","2":"建议","3":"举报","4":"其它"},"c":{"0":"待处理","1":"已指派","2":"已处理","3":"已结束"},"b":{"0":"#0366d6","1":"#fba524","2":"#49c10f","3":"#909399"},"a":{"status":[{"text":"待处理","value":0},{"text":"已指派","value":1},{"text":"已处理","value":2},{"text":"已结束","value":3}],"client":[{"text":"重制","value":"std"},{"text":"缘起","value":"origin"}]}}')},4657:function(t,e,n){},5331:function(t,e,n){},"533b":function(t,e,n){},"55ce":function(t,e,n){t.exports=n.p+"img/hide.acfa7848.svg"},"583c":function(t,e,n){"use strict";n("de7b")},"66e6":function(t,e,n){t.exports=n.p+"img/github.b9f64033.svg"},"819b":function(t,e,n){t.exports=n.p+"img/comment.2840ad61.svg"},"83b85":function(t,e,n){t.exports=n.p+"img/view.c2d7d5c4.svg"},9045:function(t,e,n){},a135:function(t,e,n){"use strict";n("a88b")},a15b:function(t,e,n){"use strict";var i=n("23e7"),s=n("e330"),a=n("44ad"),o=n("fc6a"),r=n("a640"),c=s([].join),l=a!==Object,u=l||!r("join",",");i({target:"Array",proto:!0,forced:u},{join:function(t){return c(o(this),void 0===t?",":t)}})},a88b:function(t,e,n){},b143:function(t,e,n){"use strict";n("5331")},b4fa:function(t,e,n){"use strict";n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return o})),n.d(e,"g",(function(){return l})),n.d(e,"e",(function(){return u}));var i=n("41cb");function s(t){return Object(i["d"])().post("/api/im-sure-leave-jx3box",{password:t})}function a(t){return Object(i["c"])().post("/api/miscfeedback",t)}function o(t){return Object(i["c"])().get("/api/miscfeedback",{params:t})}function r(t){return Object(i["c"])().get("/api/miscfeedback/my/list",{params:t})}function c(t){return Object(i["c"])().get("/api/miscfeedback/".concat(t))}function l(t,e){return Object(i["c"])().patch("/api/miscfeedback/".concat(t),e)}function u(){return Object(i["b"])().get("/api/cms/account/teammate").then((function(t){return t.data.data}))}},b5c8:function(t,e,n){"use strict";n("533b")},b5d3:function(t,e,n){},b716:function(t,e,n){t.exports=n.p+"img/heart_1.60e0229c.svg"},b8d3:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return t.data?e("div",{staticClass:"m-feed-single"},[e("main",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-single-content"},[e("div",{staticClass:"m-type"},[e("span",{staticClass:"u-status",style:{backgroundColor:t.statusColors[t.data.status]}},[t._v(t._s(t.statusMap[t.data.status]))]),e("div",{staticClass:"u-type"},[e("span",{staticClass:"u-value"},[t._v(t._s(t.types[t.data.type]))]),e("span",{staticClass:"u-value"},[t._v(t._s(t.subtypes[t.data.subtype]))])]),t.isTeammate?e("el-button",{attrs:{size:"mini"},on:{click:t.showVisible}},[t._v(t._s(t.$t("处理")))]):t._e()],1),e("div",{staticClass:"m-block m-user"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v(t._s(t.$t("提交人：")))]),e("a",{staticClass:"u-item u-user",attrs:{href:t.authorLink(t.data.user.id),target:"_blank"}},[e("img",{staticClass:"u-user-avatar",attrs:{src:t.showAvatar(t.data.user.avatar)}}),e("span",{staticClass:"u-user-name"},[t._v(t._s(t.data.user.display_name))])])]),e("span",{staticClass:"u-time u-subblock"},[t._v(t._s(t.$t("提交时间：")+t.formateTime(t.data.created_at)))])]),e("div",{staticClass:"m-block m-dev"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v(t._s(t.$t("分配至：")))]),t.data.assign_user&&t.data.assign_user.length?e("div",{staticClass:"u-list u-list-assign"},t._l(t.data.assign_user,(function(n){return e("a",{key:n.id,staticClass:"u-item u-assign",attrs:{href:t.authorLink(n.id),target:"_blank"}},[e("img",{staticClass:"u-assign-avatar",attrs:{src:t.showAvatar(n.avatar)}}),e("span",{staticClass:"u-assign-name"},[t._v(t._s(n.display_name))])])})),0):e("div",{staticClass:"u-list u-list-assign"},[e("a",{staticClass:"u-item u-assign",attrs:{href:t.authorLink(1),target:"_blank"}},[e("img",{staticClass:"u-assign-avatar",attrs:{src:t.showAvatar("https://oss.vl3box.com/upload/avatar/2021/3/18/6568744.png")}}),e("span",{staticClass:"u-assign-name"},[t._v("JX3BOX")])])])]),e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v(t._s(t.$t("关联仓库：")))]),e("div",{staticClass:"u-list u-list-repo"},[t.data.repository?e("a",{staticClass:"u-repo u-item",attrs:{href:t.formateGithub(t.data.repository),target:"_blank"}},[e("img",{staticClass:"u-repo-icon",attrs:{src:n("66e6"),alt:""}}),e("span",{staticClass:"u-repo-name"},[t._v(t._s(t.data.repository))])]):e("div",{staticClass:"u-null"},[t._v("-")])])])]),t.data.refer?e("div",{staticClass:"m-block m-refer"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v(t._s(t.$t("来源：")))]),e("a",{staticClass:"u-item u-user",attrs:{href:t.data.refer,target:"_blank"}},[t._v(" "+t._s(t.data.refer)+" ")])])]):t._e(),e("div",{staticClass:"m-content m-textarea"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-edit-outline"}),t._v(" "+t._s(t.$t("反馈内容")))]),e("div",{staticClass:"u-detail"},[e("span",{domProps:{innerHTML:t._s(t.sanitizedHTML(t.data.content))}})])],1),e("div",{staticClass:"m-attachment m-textarea"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-picture-outline-round"}),t._v(" "+t._s(t.$t("附件截图")))]),e("div",{staticClass:"u-detail"},t._l(t.data.images,(function(n,i){return e("div",{key:i,staticClass:"u-img"},[e("el-image",{attrs:{src:n,lazy:"","preview-src-list":t.data.images}})],1)})),0)],1),t.done?e("div",{staticClass:"m-reply"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-chat-line-square"}),t._v(" "+t._s(t.$t("回复处理")))]),e("Comment",{attrs:{id:t.id,category:"feedback",order:"desc"}})],1):t._e()]),e("el-dialog",{attrs:{visible:t.visible,title:t.$t("处理"),width:"750px"},on:{"update:visible":function(e){t.visible=e}}},[e("el-form",{attrs:{model:t.formData,rules:t.rules,"label-position":"top"}},[e("el-form-item",{attrs:{label:t.$t("关联处理人")}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:t.$t("请选择关联处理人"),filterable:"",multiple:""},model:{value:t.formData.assign,callback:function(e){t.$set(t.formData,"assign",e)},expression:"formData.assign"}},t._l(t.teammates,(function(n){return e("el-option",{key:n.id,attrs:{label:n.teammate_info.display_name,value:n.user_id}},[e("div",{staticClass:"m-teammate"},[e("div",{staticClass:"m-user"},[e("img",{staticClass:"u-avatar",attrs:{src:t.showAvatar(n.teammate_info.user_avatar)}}),e("span",{staticClass:"u-name"},[t._v(t._s(n.teammate_info.display_name))]),e("span",{staticClass:"u-user-id"},[t._v("(ID: "+t._s(n.user_id)+")")])]),e("div",{staticClass:"m-duty"},[n.duty?e("span",{staticClass:"u-duty"},[t._v(t._s(t.formateDuty(n.duty))+" | ")]):t._e(),e("span",{staticClass:"u-remark"},[t._v(t._s(n.remark))])])])])})),1)],1),e("el-form-item",{attrs:{label:t.$t("仓库")}},[e("el-input",{attrs:{placeholder:t.$t("请输入仓库")},model:{value:t.formData.repository,callback:function(e){t.$set(t.formData,"repository",e)},expression:"formData.repository"}})],1),e("el-form-item",{attrs:{label:t.$t("状态")}},[e("el-radio-group",{model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},[e("el-radio-button",{attrs:{label:0}},[t._v(t._s(t.$t("待处理")))]),e("el-radio-button",{attrs:{label:1}},[t._v(t._s(t.$t("已指派")))]),e("el-radio-button",{attrs:{label:2}},[t._v(t._s(t.$t("已处理")))]),e("el-radio-button",{attrs:{label:3}},[t._v(t._s(t.$t("已结束")))])],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.visible=!1}}},[t._v(t._s(t.$t("取 消")))]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.$t("确 定")))])],1)],1)],1):t._e()},s=[],a=n("c7eb"),o=n("1da1"),r=(n("4de4"),n("caad"),n("d81d"),n("13d5"),n("d3b7"),n("ac1f"),n("5319"),n("c0c4")),c=n.n(r),l=n("b4fa"),u=n("8e44"),m=n("4437"),d=n("85e4"),p=n("c1df"),h=n.n(p),f=function(){var t=this,e=t._self._c;return e("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-comment"},[e("el-main",[e("CommentInputForm",{on:{submit:t.userSubmitInputForm}}),e("div",{staticClass:"c-comment-panel"},[e("div",{staticClass:"u-order"},[e("span",{staticClass:"u-label"},[t._v(t._s(t.$t("排序模式：")))]),e("el-radio-group",{attrs:{size:"mini"},on:{change:t.changeOrder},model:{value:t.isDesc,callback:function(e){t.isDesc=e},expression:"isDesc"}},[e("el-radio-button",{attrs:{label:"DESC"}},[t._v(t._s(t.$t("最后靠前")))]),e("el-radio-button",{attrs:{label:"ASC"}},[t._v(t._s(t.$t("最早靠前")))])],1)],1),e("div",{staticClass:"u-op"},[e("el-switch",{staticClass:"c-comment-panel-likes",attrs:{"active-text":t.$t("获赞靠前")},on:{change:t.changeOrderByLikes},model:{value:t.orderByLikes,callback:function(e){t.orderByLikes=e},expression:"orderByLikes"}}),t.commentPower.is_author||t.commentPower.is_editor?e("el-switch",{staticClass:"c-comment-panel-likes",attrs:{"active-text":t.$t("开启过滤"),title:t.$t("开启过滤后，仅设为显示的评论可被其他人所见")},on:{change:t.changeWhiteList},model:{value:t.openWhiteList,callback:function(e){t.openWhiteList=e},expression:"openWhiteList"}}):t._e()],1)]),t.isNormal?[t._l(t.commentList,(function(n){return e("div",{key:n.id,staticClass:"c-comment-list"},[e("CommentAvatar",{attrs:{"user-avatar":t._f("showAvatar")(n.avatar),"user-href":t._f("profileLink")(n.userId),username:n.displayName,avatarFrame:n.user_avatar_frame,withFrame:!0,avatarSize:48}}),e("CommentAndReply",{attrs:{"base-api":t.baseAPI,item:n,category:t.category,power:t.commentPower,"user-href":t._f("profileLink")(n.userId),username:n.displayName},on:{deleteComment:t.deleteComment,setTopComment:t.setTopComment,setStarComment:t.setStarComment,setWhiteComment:t.setWhiteComment,setLikeComment:t.setLikeComment,hide:t.hideComment}})],1)})),e("div",{staticClass:"c-comment-pages"},[t.commentList.length>5?e("CommentInputForm",{attrs:{isBottom:t.commentList.length>5},on:{submit:t.userSubmitInputForm}}):t._e(),e("div",{staticClass:"u-pages"},[e("el-pagination",{staticStyle:{"text-align":"right"},attrs:{background:"","hide-on-single-page":"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"prev, pager, next, total",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1)]:t._e()],2)],1)},v=[],b=(n("99af"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-comment-avatar"},[e("a",{staticClass:"u-avatar",attrs:{href:t.userHref,target:"_blank"}},[e("el-avatar",{staticClass:"u-avatar-pic",attrs:{shape:"circle",size:t.avatarSize,src:t.userAvatar}}),t.avatarFrame?e("i",{staticClass:"u-avatar-frame",class:36==t.avatarSize?"xxs":"xs"},[e("img",{attrs:{src:t.frameUrl}})]):t._e()],1),e("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username))])],1)}),g=[],C=n("65c2"),_={props:["avatarSize","userAvatar","userHref","username","avatarFrame","withFrame"],data:function(){return{}},computed:{frameUrl:function(){return C["__imgPath"]+"avatar/images/".concat(this.avatarFrame,"/").concat(this.avatarFrame,".svg")}},methods:{},mounted:function(){}},y=_,w=(n("18aa"),n("2877")),k=Object(w["a"])(y,b,g,!1,null,null,null),x=k.exports,L=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-box",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{attrs:{rows:"3",type:"textarea",maxlength:t.maxLength,"show-word-limit":"",placeholder:"参与讨论...",id:t.inputId},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}}),e("quickReply",{on:{reply:t.onQuickReply}}),e("div",{staticClass:"c-comment-secret"},[e("el-checkbox",{staticClass:"u-secret",attrs:{border:"",size:"mini"},model:{value:t.is_secret,callback:function(e){t.is_secret=e},expression:"is_secret"}},[t._v("悄悄话 "),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("勾选悄悄话后仅作者和你可见，并且不可再变更状态"),placement:"top"}},[e("i",{staticClass:"el-icon-info"})])],1)],1)],1),t.showUploader?e("Uploader",{ref:"uploader",staticClass:"u-uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e(),e("div",{staticClass:"u-toolbar"},[e("el-button",{staticClass:"u-publish",attrs:{type:"primary",disabled:t.disableSubmitBtn},on:{click:t.onSubmit}},[t._v(t._s(t.$t("发表评论")))])],1)],1)],1)},$=[],S=(n("a15b"),function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:"https://cms.jx3box.com/api/cms/upload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:t.maxCount,accept:t.acceptedExtensions.reduce((function(t,e){return t+".".concat(e,",")}),""),multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 最多上传 "+t._s(t.maxCount)+" 张 "+t._s(t.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+t._s(t.maxSize/1024/1024)+" MB ")])]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)}),R=[],I={data:function(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:2097152}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"最多上传 ".concat(this.maxCount," 张图片！"),type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>this.maxSize?(this.$notify({title:"",message:"单张图片大小不能超过 ".concat(this.maxSize/1024/1024," MB！"),type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data),this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[])},onError:function(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}},j=I,F=Object(w["a"])(j,S,R,!1,null,null,null),O=F.exports,P=n("c840"),U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-jx3box-reply"},[e("el-popover",{ref:"quickReply",attrs:{"visible-arrow":!0,placement:"top",trigger:"click","popper-class":"c-jx3box-reply-pop"}},[e("div",{staticClass:"c-jx3box-reply-pop__content"},[e("i",{staticClass:"el-icon-close u-close",on:{click:t.closePop}}),e("div",{staticClass:"u-title"},[t._v(t._s(t.$t("快捷回复")))]),e("div",{staticClass:"m-reply-list"},t._l(t.replyTemplate,(function(n,i){return e("div",{key:i,staticClass:"m-reply-list__item",on:{click:function(e){return t.reply(n)}}},[t._v(" "+t._s(n)+" ")])})),0)]),e("img",{staticClass:"u-reference",attrs:{slot:"reference",width:"24",height:"24",src:n("819b"),alt:"comment"},slot:"reference"})])],1)},T=[],A=n("25c3"),D={name:"QuickReply",data:function(){return{replyTemplate:A}},emits:["reply"],methods:{closePop:function(){this.$refs.quickReply&&this.$refs.quickReply.doClose()},reply:function(t){this.$emit("reply",t),this.closePop()}}},z=D,E=(n("b143"),Object(w["a"])(z,U,T,!1,null,null,null)),B=E.exports,H={name:"CommentInputForm",components:{Uploader:O,Emotion:P["a"],quickReply:B},props:{isBottom:{type:Boolean,default:!1}},mounted:function(){this.isBottom&&(this.inputId="textarea-bottom")},data:function(){return{maxLength:500,showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top",is_secret:!1}},methods:{onSubmit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},onQuickReply:function(t){this.$emit("submit",{content:t,attachmentList:[],is_template:1})},attachmentUploadFinish:function(t){this.$emit("submit",{content:this.newComment.content,is_secret:this.is_secret?1:0,attachmentList:t}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){this.insertVariable(t)},insertVariable:function(t){var e=this;return Object(o["a"])(Object(a["a"])().mark((function n(){var i,s,o,r;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=document.querySelector("#".concat(e.inputId)),s=t.key,!i.selectionStart&&0!==i.selectionStart){n.next=12;break}return o=i.selectionStart,r=i.selectionEnd,e.newComment.content=i.value.substring(0,o)+s+i.value.substring(r,i.value.length),n.next=8,e.$nextTick();case 8:i.focus(),i.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.newComment.content=s;case 13:case"end":return n.stop()}}),n)})))()}}},N=H,W=(n("bc4e"),Object(w["a"])(N,L,$,!1,null,null,null)),M=W.exports,q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-comment-cmt"},[e("div",{staticClass:"c-comment-cmt__author"},[e("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username||"人字榜800线无名小侠"))]),t.item.is_top?e("span",{staticClass:"u-mark u-top"},[e("i",{staticClass:"el-icon-download"}),t._v(t._s(t.$t("置顶")))]):t._e(),t.item.is_star?e("span",{staticClass:"u-mark u-star"},[e("i",{staticClass:"el-icon-star-off"}),t._v(t._s(t.$t("精华")))]):t._e(),t.item.is_secret?e("span",{staticClass:"u-mark u-secret"},[e("i",{staticClass:"el-icon-cherry"}),t._v(t._s(t.$t("悄悄话")))]):t._e()],1),e("ContentOfCommentAndReply",{attrs:{date:t.item.commentDate,content:t.item.content,"comment-id":t.item.id,attachments:t._f("stringToArray")(t.item.attachments),"can-delete":t.power.can_del||t.power.uid==t.item.userId,"can-set-top":(t.power.is_author||t.power.is_editor)&&!t.item.is_top,"can-cancel-top":(t.power.is_author||t.power.is_editor)&&t.item.is_top,"can-set-star":!t.item.is_star&&(t.power.is_author||t.power.is_editor),"can-cancel-star":t.item.is_star&&(t.power.is_author||t.power.is_editor),"can-add-white":!t.item.is_white&&1==t.power.article_open_white,"can-remove-white":t.item.is_white&&(1==t.power.is_author||1==t.power.is_editor),"can-hide":1==t.power.is_author||1==t.power.is_editor,"is-like":1==t.item.is_likes,likes:~~t.item.likes},on:{addNewReply:t.addNewReply,deleteComment:t.deleteComment,setTopComment:t.setTopComment,setStarComment:t.setStarComment,setLikeComment:t.setLikeComment,setWhiteComment:t.setWhiteComment,hide:t.hideComment}}),e("ReplyList",{attrs:{data:t.replyList,pager:t.pager,power:t.power},on:{addNewReply:t.addNewReply,deleteReply:t.deleteReply,goto:t.gotoReplyListIndex,resetReply:t.resetReply,setLikeComment:t.setLikeReply,hide:t.hideComment}})],1)},J=[],V=(n("b64b"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-cmt"},[""!=t.content?e("div",{staticClass:"u-text",domProps:{innerHTML:t._s(t.renderContent)}}):t._e(),t.attachments.length?e("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(n){return e("el-image",{key:n,attrs:{src:t._f("showAttachment")(n),"preview-src-list":[t.showPreview(n)],lazy:""}})})),1):t._e(),e("div",{staticClass:"u-toolbar u-toolbar--primary"},[e("div",{staticClass:"u-toolbar-left"},[t.currentUserHadLike?t._e():e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.doLike(!0)}}},[e("img",{staticClass:"u-up",attrs:{src:n("b716"),alt:""}}),t._v(t._s(t.$t("点赞"))),e("span",{staticClass:"u-like-count"},[t._v(t._s(t.likesFormat(t.hasLikeCount)))])]),t.currentUserHadLike?e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.doLike(!1)}}},[e("img",{staticClass:"u-up",attrs:{src:n("e5de"),alt:""}}),t._v(t._s(t.$t("已赞"))),e("span",{staticClass:"u-like-count"},[t._v(t._s(t.likesFormat(t.hasLikeCount)))])]):t._e(),e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini",icon:"el-icon-chat-round"},on:{click:function(e){t.showForm=!t.showForm}}},[t._v(t._s(t.$t("回复")))]),t.canDelete?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v(t._s(t.$t("删除")))]):t._e(),t.canHide?e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:t.$t("拉入黑洞后，仅评论者自己独自可见")},on:{click:function(e){return t.hideComment()}}},[t._v(t._s(t.$t("黑洞")))]):t._e(),t.canSetTop?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-top",size:"mini"},on:{click:function(e){return t.topComment(!0)}}},[t._v(t._s(t.$t("置顶")))]):t._e(),t.canCancelTop?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-top",size:"mini"},on:{click:function(e){return t.topComment(!1)}}},[t._v(t._s(t.$t("取消置顶")))]):t._e(),t.canSetStar?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-star-off",size:"mini"},on:{click:function(e){return t.starComment(!0)}}},[t._v(t._s(t.$t("加精")))]):t._e(),t.canCancelStar?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-star-on",size:"mini"},on:{click:function(e){return t.starComment(!1)}}},[t._v(t._s(t.$t("取消加精")))]):t._e(),e("time",{staticClass:"u-date"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1),e("div",{staticClass:"u-toolbar-right"},[t.canAddWhite?e("el-button",{staticClass:"u-admin u-filter",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.setWhiteComment(!0)}}},[e("img",{staticClass:"u-icon-filter",attrs:{src:n("83b85"),alt:t.$t("显示")}}),t._v(" 显示")]):t._e(),t.canRemoveWhite?e("el-button",{staticClass:"u-admin u-filter",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.setWhiteComment(!1)}}},[e("img",{staticClass:"u-icon-filter",attrs:{src:n("55ce"),alt:t.$t("隐藏")}}),t._v(t._s(t.$t("隐藏")))]):t._e()],1)]),t.showForm?e("el-form",{ref:"form",staticClass:"c-comment-subbox",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{attrs:{type:"textarea",placeholder:"参与评论...",id:"id"+t.inputId},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}})],1),t.showUploader?e("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),e("el-form-item",[e("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submit()}}},[t._v(t._s(t.$t("提交")))]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.showForm=!1}}},[t._v(t._s(t.$t("收起")))])],1)],1):t._e()],1)}),Y=[],X=n("506c");function G(t){return t.replace(/[<>"']/g,(function(t){switch(t){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;"}}))}async function Q(t){const e=new X["a"](G(t));return await e._renderHTML()}function K(t){return t>9?t:"0".concat(t)}var Z={props:["content","date","hasReply","canDelete","canSetTop","canCancelTop","canHide","isLike","likes","canSetStar","canCancelStar","attachments","commentId","canAddWhite","canRemoveWhite"],components:{Uploader:O,Emotion:P["a"]},data:function(){return{newComment:{content:""},showForm:!1,disableSubmitBtn:!1,showUploader:!1,inputId:"",previewList:[],currentUserHadLike:this.isLike,hasLikeCount:this.likes,renderContent:""}},watch:{content:{handler:function(t){this.formatContent(t)},immediate:!0}},mounted:function(){this.commentId&&(this.inputId=this.commentId)},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(d["resolveImagePath"])(t)}))}},methods:{doLike:function(t){t!==this.currentUserHadLike&&(this.currentUserHadLike=t,this.hasLikeCount=t?this.hasLikeCount+1:this.hasLikeCount-1,this.$emit("setLikeComment",t))},topComment:function(t){this.$emit("setTopComment",t)},starComment:function(t){this.$emit("setStarComment",t)},setWhiteComment:function(t){this.$emit("setWhiteComment",t)},deleteComment:function(){var t=this;this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("deleteComment")})).catch((function(){}))},hideComment:function(){var t=this;this.$confirm("确定隐藏该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("hide",t.commentId)})).catch((function(){}))},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+K(e.getMonth()+1)+"-"+K(e.getDate())+" "+K(e.getHours())+":"+K(e.getMinutes())+":"+K(e.getSeconds())},likesFormat:function(t){return t>0?t:""},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("addNewReply",{content:this.newComment.content,attachmentList:t}),this.showUploader=!1,this.newComment={content:""}},attachmentUplodError:function(){this.disableSubmitBtn=!1},submit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){},formatContent:function(t){var e=this;return Object(o["a"])(Object(a["a"])().mark((function n(){return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Q(t);case 2:e.renderContent=n.sent;case 3:case"end":return n.stop()}}),n)})))()},handleEmotionSelected:function(t){var e=this;return Object(o["a"])(Object(a["a"])().mark((function n(){var i,s,o,r;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=document.querySelector("#id".concat(e.inputId)),s=t.key,!i.selectionStart&&0!==i.selectionStart){n.next=12;break}return o=i.selectionStart,r=i.selectionEnd,e.newComment.content=i.value.substring(0,o)+s+i.value.substring(r,i.value.length),n.next=8,e.$nextTick();case 8:i.focus(),i.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.newComment.content=s;case 13:case"end":return n.stop()}}),n)})))()},showPreview:function(t){return Object(d["resolveImagePath"])(t)}},filters:{showAttachment:function(t){return Object(d["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}}},tt=Z,et=(n("d9e8"),Object(w["a"])(tt,V,Y,!1,null,null,null)),nt=et.exports,it=function(){var t=this,e=t._self._c;return t.data.length?e("div",{staticClass:"c-comment-replylist"},[t._l(t.data,(function(n){return e("reply-item",{key:n.id,staticClass:"c-comment-reply",attrs:{reply:n,power:t.power},on:{deleteReply:t.deleteReply,addReply:t.addReply,setLikeComment:t.setLikeComment,hide:t.hideReply}})})),t.data.length>=3||t.showPager?e("el-row",[e("el-col",{attrs:{span:4}},[e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showLess()}}},[t._v(t._s(t.$t("收起")))]),e("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.showPager,expression:"!showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showMore()}}},[t._v(t._s(t.$t("查看更多")))])],1),e("el-col",{staticClass:"c-comment-reply-pages",attrs:{span:20}},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{small:"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"total, prev, pager, next",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1):t._e()],2):t._e()},st=[],at=function(){var t=this,e=t._self._c;return e("el-row",[e("CommentAvatar",{attrs:{"user-avatar":t._f("showAvatar")(t.reply.avatar),"user-href":t._f("profileLink")(t.reply.userId),username:t.reply.displayName,avatarFrame:t.reply.user_avatar_frame,avatarSize:36}}),e("CommentContentSimple",{attrs:{"comment-id":t.reply.id,date:t.reply.commentDate,content:t.reply.content,attachments:t._f("stringToArray")(t.reply.attachments),"can-delete":t.power.can_del||t.power.uid==t.reply.userId,"can-hide":1==t.power.is_author||1==t.power.is_editor,"can-reply":t.power.uid!=t.reply.userId,"user-href":t._f("profileLink")(t.reply.replyForUID),"reply-for-username":t.reply.replyForUsername,"reply-for-user-id":t.reply.replyForUID,"is-like":1==t.reply.is_likes,likes:~~t.reply.likes},on:{delete:t.deleteReply,showReplyInput:function(e){t.showReplyForReplyFrom=!t.showReplyForReplyFrom},setLikeComment:t.setLikeComment,hide:t.hideReply}}),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.reply.displayName,"user-href":t._f("profileLink")(t.reply.userId),"current-id":t.reply.id},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1)},ot=[],rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-reply"},[e("div",{staticClass:"u-reply-content"},[0!=t.replyForUserId?e("span",{staticClass:"u-reply-label"},[t._v(" "+t._s(t.$t("回复"))+" "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("@"+t._s(t.replyForUsername))]),t._v(" : ")],1):t._e(),e("div",{staticClass:"u-reply-text",domProps:{innerHTML:t._s(t.renderContent)}})]),t.attachments.length?e("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(n){return e("el-image",{key:n,attrs:{src:t._f("showAttachment")(n),"preview-src-list":[t.showPreview(n)],lazy:""}})})),1):t._e(),e("div",{staticClass:"u-toolbar"},[t.currentUserHadLike?t._e():e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.doLike(!0)}}},[e("img",{staticClass:"u-up",attrs:{src:n("b716"),alt:""}}),t._v(t._s(t.$t("点赞"))),e("span",{staticClass:"u-like-count"},[t._v(t._s(t.likesFormat(t.hasLikeCount)))])]),t.currentUserHadLike?e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.doLike(!1)}}},[e("img",{staticClass:"u-up",attrs:{src:n("e5de"),alt:""}}),t._v(t._s(t.$t("已赞"))),e("span",{staticClass:"u-like-count"},[t._v(t._s(t.likesFormat(t.hasLikeCount)))])]):t._e(),t.canReply?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-chat-line-round",size:"mini"},on:{click:function(e){return t.showReplyForReplyInput()}}},[t._v(t._s(t.$t("回复")))]):t._e(),t.canDelete?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v(t._s(t.$t("删除")))]):t._e(),t.canHide?e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:t.$t("拉入黑洞后，仅评论者自己独自可见")},on:{click:function(e){return t.hideComment()}}},[t._v(" "+t._s(t.$t("黑洞")))]):t._e(),e("time",{staticClass:"u-date"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1)])},ct=[];function lt(t){return t>9?t:"0".concat(t)}var ut={props:["commentId","content","attachments","date","hasReply","canDelete","canHide","canReply","isLike","likes","userHref","replyForUsername","replyForUserId"],data:function(){return{showInput:!1,currentUserHadLike:this.isLike,hasLikeCount:this.likes,renderContent:""}},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(d["resolveImagePath"])(t)}))}},watch:{content:{handler:function(t){this.formatContent(t)},immediate:!0}},filters:{profileLink:function(t){return Object(d["authorLink"])(t)},showAttachment:function(t){return Object(d["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}},methods:{formatContent:function(t){var e=this;return Object(o["a"])(Object(a["a"])().mark((function n(){return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Q(t);case 2:e.renderContent=n.sent;case 3:case"end":return n.stop()}}),n)})))()},getPList:function(t){return t.split("\n")},doLike:function(t){t!==this.currentUserHadLike&&(this.currentUserHadLike=t,this.hasLikeCount=t?this.hasLikeCount+1:this.hasLikeCount-1,this.$emit("setLikeComment",t))},deleteComment:function(){var t=this;this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("delete",t.commentId)})).catch((function(){}))},hideComment:function(){var t=this;this.$confirm("确定隐藏该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("hide",t.commentId)})).catch((function(){}))},likesFormat:function(t){return t>0?t:""},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+lt(e.getMonth()+1)+"-"+lt(e.getDate())+" "+lt(e.getHours())+":"+lt(e.getMinutes())+":"+lt(e.getSeconds())},showReplyForReplyInput:function(){this.$emit("showReplyInput")},previewImg:function(t){this.$hevueImgPreview({multiple:!0,nowImgIndex:t,imgList:this._attachments,controlBar:!1,clickMaskCLose:!0})},showPreview:function(t){return Object(d["resolveImagePath"])(t)}}},mt=ut,dt=(n("b5c8"),Object(w["a"])(mt,rt,ct,!1,null,null,null)),pt=dt.exports,ht=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-subbox"},[e("div",{staticClass:"u-subbox-label"},[t._v(" 回复 "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("＠"+t._s(t.username))]),t._v(" ： ")],1),e("el-form-item",[e("el-input",{attrs:{type:"textarea",id:"id"+t.inputId,placeholder:t.$t("输入回复...")},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}})],1),t.showUploader?e("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),e("el-form-item",[e("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submintReply()}}},[t._v(t._s(t.$t("提交")))]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.hideForm()}}},[t._v(t._s(t.$t("收起")))])],1)],1)},ft=[],vt={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Uploader:O,Emotion:P["a"]},mounted:function(){this.currentId&&(this.inputId=this.currentId)},methods:{submintReply:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){this.$emit("hideForm")},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:t}),this.content="",this.showUploader=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){var e=this;return Object(o["a"])(Object(a["a"])().mark((function n(){var i,s,o,r;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=document.querySelector("#id".concat(e.inputId)),s=t.key,!i.selectionStart&&0!==i.selectionStart){n.next=12;break}return o=i.selectionStart,r=i.selectionEnd,e.content=i.value.substring(0,o)+s+i.value.substring(r,i.value.length),n.next=8,e.$nextTick();case 8:i.focus(),i.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.content=s;case 13:case"end":return n.stop()}}),n)})))()}}},bt=vt,gt=(n("e43b"),Object(w["a"])(bt,ht,ft,!1,null,null,null)),Ct=gt.exports,_t={props:["reply","power"],components:{CommentAvatar:x,CommentContentSimple:pt,ReplyForReply:Ct},backReplyList:[],data:function(){return{showReplyForReplyFrom:!1}},filters:{profileLink:function(t){return Object(d["authorLink"])(t)},stringToArray:function(t){return t?JSON.parse(t):[]},showAvatar:function(t){return Object(d["showAvatar"])(t,84)}},methods:{deleteReply:function(t){this.$emit("deleteReply",t)},hideReply:function(t){this.$emit("hide",t)},setLikeComment:function(t){this.$emit("setLikeComment",this.reply.id,t)},doReply:function(t){t.replyForUID=this.reply.userId,t.replyForCommentId=this.reply.id,this.$emit("addReply",t),this.showReplyForReplyFrom=!1}}},yt=_t,wt=Object(w["a"])(yt,at,ot,!1,null,null,null),kt=wt.exports,xt={props:["data","power","pager"],components:{ReplyItem:kt},data:function(){return{showPager:!1}},filters:{profileLink:function(t){return Object(d["authorLink"])(t)}},methods:{showMore:function(){this.showPager=!0,this.$emit("goto",1)},showLess:function(){this.showPager=!1,this.$emit("resetReply")},handleCurrentChange:function(t){this.$emit("goto",t)},deleteReply:function(t){this.$emit("deleteReply",t)},hideReply:function(t){this.$emit("hide",t)},setLikeComment:function(t,e){this.$emit("setLikeComment",t,e)},addReply:function(t){this.$emit("addNewReply",t)}}},Lt=xt,$t=(n("0906"),Object(w["a"])(Lt,it,st,!1,null,null,null)),St=$t.exports,Rt=n("5c96");const It=function(t,e){let n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return Ut(t,e,n)};var jt={};const Ft=function(t,e,n){if(jt[t])if(Date.now()-jt[t].lastest<6e4){if(jt[t].count>=6)return Rt["Notification"].warning({title:"系统",message:"你单身多久了? 动作这么快, 系统处理不过来 ( T_T )",duration:3e3,position:"bottom-right"}),new Promise((t,e)=>{e()});jt[t].count=jt[t].count+1}else Date.now()-jt[t].lastest>6e4&&(jt[t]={lastest:Date.now(),count:0});else jt[t]={lastest:Date.now(),count:0};let i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return Ut(t,e,i)},Ot=function(t,e,n){let i={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return Ut(t,e,i)},Pt=function(t,e){let n={method:"DELETE"};return Ut(t,e,n)};function Ut(t,e,n){let i=C["__next"];if("/"==i[i.length-1]&&(i=i.substring(0,i.length-1)),t=i+t,t=t.replace("/api/","/api/next2/"),n.credentials="include",e){let n=[];Object.keys(e).forEach(t=>{n.push(t+"="+e[t])});let i=C["__next"];"/"==i[i.length-1]&&(i=i.substring(0,i.length-1)),t=t+"?"+n.join("&")}return fetch(t,n).then(t=>{switch(t.status){case 200:break;case 401:throw window.location.href=C["__Links"].account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 403:throw window.location.href=C["__Links"].account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 423:throw window.location.href=C["__Links"].account.email_verify+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 406:throw t.text().then(t=>{Rt["Notification"].warning({title:"系统",message:t||"提交内容不合法,请重新提交",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText);default:throw t.text().then(e=>{Rt["Notification"].error({title:"系统:"+t.statusText,message:e||"系统错误,请稍后重试!",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText)}let e=t.headers.get("Content-Type");switch(e=e&&e.split(";").shift(),e){case"application/json":return t.json().then(t=>t&&t.code>0&&""!=t.msg?(Rt["Notification"].warning({title:"提示",message:t.code+":"+t.msg,duration:3e3,position:"bottom-right"}),null):t);default:return t.text()}})}var Tt={props:["item","baseApi","power","user-href","username"],components:{ContentOfCommentAndReply:nt,ReplyList:St},data:function(){return{replyList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0}}},filters:{stringToArray:function(t){return t?JSON.parse(t):[]}},created:function(){this.replyList=this.item.reply||[]},methods:{deleteComment:function(){this.$emit("deleteComment",this.item.id)},hideComment:function(){this.$emit("hide",this.item.id)},setTopComment:function(t){this.$emit("setTopComment",this.item.id,t)},setStarComment:function(t){this.$emit("setStarComment",this.item.id,t)},setLikeComment:function(t){this.$emit("setLikeComment",this.item.id,t)},setLikeReply:function(t,e){this.$emit("setLikeComment",t,e)},setWhiteComment:function(t){this.$emit("setWhiteComment",this.item.id,t)},addNewReply:function(t){var e=this;Ft("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply"),null,t).then((function(){e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},deleteReply:function(t){var e=this;Pt("".concat(this.baseApi,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},gotoReplyListIndex:function(t){this.loadReplyList(t,6)},loadReplyList:function(t,e){var n=this;It("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply/page/").concat(t,"?pageSize=").concat(e)).then((function(i){1==t&&3==e&&(n.item.reply=i.data||[]),n.replyList=i.data||[],n.pager=i.page})).catch((function(){}))},resetReply:function(){this.loadReplyList(1,3)}}},At=Tt,Dt=(n("125d"),Object(w["a"])(At,q,J,!1,null,null,null)),zt=Dt.exports,Et=n("41cb"),Bt=n("c9d2");const Ht="cmt_order";async function Nt(){return Bt["a"].isLogin()?Object(Et["b"])({mute:!0}).get("/api/cms/user/conf",{params:{key:Ht}}).then(t=>t.data.data):new Promise(t=>{const e=localStorage.getItem(Ht)||"DESC";t(e)})}async function Wt(t){return Bt["a"].isLogin()?Object(Et["b"])().put("/api/cms/user/conf",{val:t},{params:{key:Ht}}).then(t=>t.data.data):new Promise(e=>{e(localStorage.setItem(Ht,t))})}var Mt={name:"Comment",props:["id","category","normal","order"],components:{CommentAvatar:x,CommentAndReply:zt,CommentInputForm:M},data:function(){return{baseAPI:"",commentPower:{allow:!1,uid:-1},commentList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0},isDesc:"DESC",orderByLikes:!1,openWhiteList:!1,loading:!1}},computed:{isNormal:function(){return void 0===this.normal||this.normal}},methods:{changeOrder:function(){this.reloadCommentList(this.pager.index),Wt("ASC"===this.isDesc?"DESC":"ASC")},changeOrderByLikes:function(){this.reloadCommentList(this.pager.index)},changeWhiteList:function(){var t=this;Ot("".concat(this.baseAPI,"/meta/white-list/").concat(this.openWhiteList?"open":"close")).then((function(){return t.reloadPower()})).then((function(){t.commentPower.is_white=t.openWhiteList,t.reloadCommentList(t.pager.index)})).catch((function(){}))},setLikeComment:function(t,e){var n=e?"like":"unlike";Ot("".concat(this.baseAPI,"/comment/").concat(t,"/").concat(n)).then((function(){})).catch((function(){}))},setTopComment:function(t,e){var n=this,i=e?"set":"cancel";Ot("".concat(this.baseAPI,"/comment/").concat(t,"/top/").concat(i)).then((function(){n.reloadCommentList(n.pager.index)})).catch((function(){}))},setStarComment:function(t,e){var n=this,i=e?"set":"cancel";Ot("".concat(this.baseAPI,"/comment/").concat(t,"/star/").concat(i)).then((function(){n.reloadCommentList(n.pager.index)})).catch((function(){}))},setWhiteComment:function(t,e){var n=this,i=e?"add":"remove";Ot("".concat(this.baseAPI,"/comment/").concat(t,"/white-list/").concat(i)).then((function(){n.reloadCommentList(n.pager.index)})).catch((function(){}))},deleteComment:function(t){var e=this;Pt("".concat(this.baseAPI,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.reloadCommentList(e.pager.index)})).catch((function(){}))},hideComment:function(t){var e=this;Ot("".concat(this.baseAPI,"/comment/").concat(t,"/hide")).then((function(){e.$notify({title:"",message:"操作成功!",type:"success",duration:3e3,position:"bottom-right"}),e.reloadCommentList(e.pager.index)})).catch((function(){}))},reloadCommentList:function(t){var e=this;this.loading=!0;var n={};"DESC"===this.isDesc&&(n["desc"]=!0),n["orderby_likes"]=this.orderByLikes,It("".concat(this.baseAPI,"/comment/page/").concat(t),n).then((function(t){e.commentList=t.data||[],e.pager=t.page})).catch((function(){})).finally((function(){e.loading=!1}))},handleCurrentChange:function(t){this.reloadCommentList(t)},userSubmitInputForm:function(t){var e=this;Ft("".concat(this.baseAPI,"/comment"),null,t).then((function(t){t&&~~t.code>0?e.$notify({title:"评论失败",message:t.msg||"",type:"error",duration:3e3,position:"bottom-right"}):(e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),1==e.pager.index&&e.reloadCommentList(e.pager.index))})).catch((function(){}))},reloadPower:function(){var t=this;It("".concat(this.baseAPI,"/i-am-author")).then((function(e){t.commentPower=e,t.openWhiteList=e.is_white})).catch((function(){}))}},filters:{profileLink:function(t){return Object(d["authorLink"])(t)},showAvatar:function(t){return Object(d["showAvatar"])(t,144)}},created:function(){this.baseAPI="/api/comment/".concat(this.category,"/article/").concat(this.id)},mounted:function(){var t=this;Nt().then((function(e){t.isDesc=e})).then((function(){t.reloadPower()})).finally((function(){t.reloadCommentList(1)}))}},qt=Mt,Jt=(n("a135"),Object(w["a"])(qt,f,v,!1,null,null,null)),Vt=Jt.exports,Yt={name:"FeedbackSingle",components:{Comment:Vt},data:function(){return{data:"",loading:!1,types:m["e"],subtypes:m["d"],statusMap:m["c"],statusColors:m["b"],done:!1,visible:!1,formData:{assign:[],repository:"",status:0},rules:{},teammates:[]}},computed:{id:function(){return this.$route.params.id},isTeammate:function(){return this.$store.state.isTeammate}},watch:{id:{immediate:!0,handler:function(t){t&&this.getData()}}},mounted:function(){this.loadTeammates()},methods:{getData:function(){var t=this;return Object(o["a"])(Object(a["a"])().mark((function e(){var n,i,s,o,r;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,Object(l["b"])(t.id);case 4:r=e.sent,t.data=r.data.data,t.data.content=t.data.content.replace(/\n/g,"<br>"),t.formData.repository=(null===(n=t.data)||void 0===n?void 0:n.repository)||"",t.formData.assign=(null===(i=t.data)||void 0===i||null===(s=i.assign)||void 0===s?void 0:s.filter((function(t){return t})))||[],t.formData.status=(null===(o=t.data)||void 0===o?void 0:o.status)||0,t.done=!0,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.log(e.t0);case 16:return e.prev=16,t.loading=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))()},loadTeammates:function(){var t=this;return Object(o["a"])(Object(a["a"])().mark((function e(){var n;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u["c"])();case 3:n=e.sent,t.teammates=n.data.data.filter((function(t){return t.group&&["mp","developer","designer"].includes(t.group)})),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},back:function(){this.$router.go(-1)},authorLink:d["authorLink"],showAvatar:d["showAvatar"],formateTime:function(t){return h()(t).format("YYYY-MM-DD HH:mm:ss")},formateGithub:function(t){return"https://github.com/JX3BOX/".concat(t)},formateDuty:function(t){return t&&t.reduce((function(t,e){return t+" | "+e}))||""},confirm:function(){var t=this;Object(l["g"])(this.id,{assign:this.formData.assign.map((function(t){return t})),repository:this.formData.repository,status:this.formData.status}).then((function(e){t.$message.success(t.$t("处理成功")),t.visible=!1,t.getData()})).catch((function(e){t.$message.error(e.message)}))},showVisible:function(){var t,e;this.formData.repository=this.data.repository,this.formData.assign=(null===(t=this.data)||void 0===t||null===(e=t.assign)||void 0===e?void 0:e.filter((function(t){return t})))||[],this.visible=!0},sanitizedHTML:function(t){return c.a.sanitize(t)}}},Xt=Yt,Gt=(n("583c"),Object(w["a"])(Xt,i,s,!1,null,null,null));e["default"]=Gt.exports},bc4e:function(t,e,n){"use strict";n("4657")},d58f:function(t,e,n){"use strict";var i=n("59ed"),s=n("7b0b"),a=n("44ad"),o=n("07fa"),r=TypeError,c=function(t){return function(e,n,c,l){var u=s(e),m=a(u),d=o(u);i(n);var p=t?d-1:0,h=t?-1:1;if(c<2)while(1){if(p in m){l=m[p],p+=h;break}if(p+=h,t?p<0:d<=p)throw new r("Reduce of empty array with no initial value")}for(;t?p>=0:d>p;p+=h)p in m&&(l=n(l,m[p],p,u));return l}};t.exports={left:c(!1),right:c(!0)}},d9e8:function(t,e,n){"use strict";n("9045")},de7b:function(t,e,n){},e43b:function(t,e,n){"use strict";n("43c2")},e5de:function(t,e,n){t.exports=n.p+"img/heart_2.cc8f76d0.svg"}}]);
//# sourceMappingURL=chunk-5707c903.341acf5a.js.map